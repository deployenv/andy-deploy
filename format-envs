#!/bin/bash
# éå†å½“å‰ç›®å½•åŠå­ç›®å½•ï¼Œæ ¼å¼åŒ–æ‰€æœ‰ *.env æ–‡ä»¶ï¼ˆåŸåœ°è¦†ç›–ï¼‰

find . -type f -name "*.env" | while read -r file; do
	echo "ğŸ“‚ æ ¼å¼åŒ–: $file"

	tmpfile=$(mktemp)
	tmpfile2=$(mktemp)

	# è®¡ç®— KEY çš„æœ€å¤§é•¿åº¦
	max_len=$(grep -vE '^\s*#|^\s*$' "$file" | cut -d= -f1 | awk '{print length}' | sort -nr | head -1)

	# æ ¼å¼åŒ–
	while IFS= read -r line; do
		if [[ "$line" =~ ^[[:space:]]*# || -z "$line" ]]; then
			echo "$line" >>"$tmpfile"
		else
			# å»é™¤å·¦å³ç©ºæ ¼ï¼Œå¹¶ä¸¥æ ¼åˆ†å‰² key/value
			key=$(echo "$line" | sed -E 's/^[[:space:]]*([^=[:space:]]+)[[:space:]]*=.*$/\1/')
			value=$(echo "$line" | sed -E 's/^[^=]*=[[:space:]]*(.*)$/\1/')
			echo "${key}=${value}" >>"$tmpfile"
		fi
	done <"$file"

	# âœ… ç§»é™¤å¤šä½™ç©ºè¡Œï¼šè¿ç»­ç©ºè¡Œ â†’ åªä¿ç•™ä¸€ä¸ª
	awk 'NF{blank=0} !NF{if(blank) next; blank=1}1' "$tmpfile" >"$tmpfile2"

	mv "$tmpfile2" "$file"
	rm -f "$tmpfile"
done

echo "âœ… æ‰€æœ‰ *.env æ–‡ä»¶æ ¼å¼åŒ–å®Œæˆï¼ˆç©ºè¡Œå·²å‹ç¼©ï¼‰ï¼"
